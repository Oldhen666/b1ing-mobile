<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>My Account â€“ B1ing</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Google Identity Services -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>

  <style>
    :root {
      --bg-orange: #ffb640;
      --card-bg: #ffffff;
      --text-main: #222222;
      --text-sub: #777777;
      --accent: #ff5a00;
      --divider: #f0f0f0;
    }

    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
      background: var(--bg-orange);
      color: var(--text-main);
    }

    .page {
      max-width: 480px;
      margin: 0 auto;
      min-height: 100vh;
      padding: 16px 12px 32px;
    }

    /* é¡¶éƒ¨æ ‡é¢˜ */
    .page-title {
      font-size: 24px;
      font-weight: 700;
      color: #fff;
      margin: 6px 4px 14px;
    }

    /* é¡¶éƒ¨ç”¨æˆ·å¡ç‰‡ */
    .card {
      background: var(--card-bg);
      border-radius: 18px;
      box-shadow: 0 6px 14px rgba(0,0,0,.10);
      padding: 16px 16px 14px;
      margin-bottom: 14px;
    }

    .user-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 8px;
    }

    .avatar-circle {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      background: #ffe1b2;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 22px;
      font-weight: 700;
      color: #c96b00;
      margin-right: 10px;
      flex-shrink: 0;
    }

    .user-main {
      flex: 1;
      min-width: 0;
    }

    .user-name {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 2px;
    }

    .user-sub {
      font-size: 13px;
      color: var(--text-sub);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .user-status {
      font-size: 13px;
      color: var(--accent);
      white-space: nowrap;
      margin-left: 10px;
    }

    .badge-row {
      display: flex;
      gap: 6px;
      margin-top: 10px;
      font-size: 11px;
    }

    .badge {
      border-radius: 999px;
      padding: 2px 8px;
      background: #fff5e0;
      color: #c46800;
      border: 1px solid #ffd59c;
    }

    .summary-row {
      display: flex;
      justify-content: space-around;
      padding-top: 10px;
      border-top: 1px solid #f3f3f3;
      margin-top: 6px;
    }

    .summary-item {
      text-align: center;
      flex: 1;
    }

    .summary-number {
      font-weight: 700;
      font-size: 16px;
      margin-bottom: 4px;
    }

    .summary-label {
      font-size: 12px;
      color: var(--text-sub);
    }

    /* ç™»å½•åŒºåŸŸ */
    .login-card {
      background: var(--card-bg);
      border-radius: 18px;
      box-shadow: 0 6px 14px rgba(0,0,0,.10);
      padding: 14px 14px 16px;
      margin-bottom: 14px;
    }

    .login-title {
      font-size: 15px;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .login-subtitle {
      font-size: 12px;
      color: var(--text-sub);
      margin-bottom: 10px;
    }

    .social-buttons {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    /* Google æŒ‰é’®å®¹å™¨ï¼Œç”¨ GIS è‡ªåŠ¨æ¸²æŸ“ */
    #google-btn {
      width: 100%;
    }

    /* å¦‚æœä»¥åè¦æ˜¾ç¤º Facebookï¼Œåªè¦åˆ é™¤ display:none å¹¶åŠ æŒ‰é’® HTML å³å¯ */
    .facebook-hidden {
      display: none;
    }

    /* ä¸»åŠŸèƒ½å¡ç‰‡ï¼ˆåˆå¹¶åçš„ Orders + Shortcuts + Settingsï¼‰ */
    .section-card {
      background: var(--card-bg);
      border-radius: 18px;
      box-shadow: 0 6px 14px rgba(0,0,0,.10);
      margin-bottom: 14px;
      overflow: hidden;
    }

    .section-header {
      padding: 12px 16px 6px;
      font-size: 14px;
      font-weight: 600;
      color: var(--text-sub);
    }

    .cell {
      padding: 12px 16px;
      display: flex;
      align-items: center;
      cursor: pointer;
    }

    .cell:active {
      background: #f5f5f5;
    }

    .cell + .cell {
      border-top: 1px solid var(--divider);
    }

    .cell-icon {
      width: 28px;
      text-align: center;
      margin-right: 10px;
      font-size: 18px;
    }

    .cell-main {
      flex: 1;
      min-width: 0;
    }

    .cell-title {
      font-size: 14px;
      font-weight: 500;
      margin-bottom: 2px;
    }

    .cell-sub {
      font-size: 12px;
      color: var(--text-sub);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .cell-right {
      font-size: 12px;
      color: var(--text-sub);
      margin-left: 10px;
      white-space: nowrap;
    }

    .arrow {
      margin-left: 4px;
    }

    /* Sign out åŒºå— */
    .signout-card {
      background: var(--card-bg);
      border-radius: 18px;
      box-shadow: 0 6px 14px rgba(0,0,0,.10);
      margin-bottom: 14px;
      overflow: hidden;
    }

    .signout-row {
      padding: 12px 16px;
      display: flex;
      align-items: center;
    }

    .signout-row:active {
      background: #f5f5f5;
    }

    .signout-label {
      margin-left: 8px;
      font-size: 14px;
    }

    .signout-sub {
      padding: 0 16px 12px;
      font-size: 11px;
      color: var(--text-sub);
    }

    /* å°å±é€‚é… */
    @media (min-width: 768px) {
      .page {
        padding-top: 24px;
      }
    }
  </style>
</head>
<body>
  <div class="page">
    <div class="page-title">My Account</div>

    <!-- é¡¶éƒ¨ç”¨æˆ·å¡ç‰‡ -->
    <div class="card" id="user-card">
      <div class="user-row">
        <div style="display:flex;align-items:center;flex:1;">
          <div class="avatar-circle" id="avatar-letter">G</div>
          <div class="user-main">
            <div class="user-name" id="user-name">Guest</div>
            <div class="user-sub" id="user-sub">Sign in to sync your orders</div>
          </div>
        </div>
        <div class="user-status" id="user-status">Not signed in</div>
      </div>

      <div class="badge-row">
        <div class="badge">Member</div>
        <div class="badge">Mobile App</div>
      </div>

      <div class="summary-row">
        <div class="summary-item">
          <div class="summary-number" id="orders-count">0</div>
          <div class="summary-label">Orders</div>
        </div>
        <div class="summary-item">
          <div class="summary-number" id="fav-count">0</div>
          <div class="summary-label">Favorites</div>
        </div>
        <div class="summary-item">
          <div class="summary-number" id="coupon-count">0</div>
          <div class="summary-label">Coupons</div>
        </div>
      </div>
    </div>

    <!-- ç™»å½•åŒºåŸŸ -->
    <div class="login-card" id="login-panel">
      <div class="login-title">Sign in or create your B1ing account</div>
      <div class="login-subtitle">
        Use Google (or later Facebook) to quickly sign in and sync your orders &amp; favorites.
      </div>

      <div class="social-buttons">
        <!-- Google button å®¹å™¨ï¼šç”± Google Identity Services æ¸²æŸ“ -->
        <div id="google-btn"></div>

        <!-- ä»¥åè¦å¯ç”¨ Facebookï¼Œåªéœ€è¦åœ¨è¿™é‡ŒåŠ æŒ‰é’® + æ‰“å¼€ JS é‡Œçš„ loginWithFacebook() -->
        <!--
        <button class="facebook-hidden" onclick="loginWithFacebook()">
          Continue with Facebook
        </button>
        -->
      </div>
    </div>

    <!-- ä¸»åŠŸèƒ½å¡ç‰‡ï¼šåˆå¹¶ Orders / Shortcuts / Settings -->
    <div class="section-card">
      <div class="section-header">Orders &amp; Account</div>

      <!-- My Orders -->
      <div class="cell" onclick="goMyOrders()">
        <div class="cell-icon">ğŸ“¦</div>
        <div class="cell-main">
          <div class="cell-title">My Orders</div>
          <div class="cell-sub">View and manage all your orders</div>
        </div>
        <div class="cell-right">
          All statuses <span class="arrow">â€º</span>
        </div>
      </div>

      <!-- My Favorites -->
      <div class="cell" onclick="goMyFavorites()">
        <div class="cell-icon">â¤ï¸</div>
        <div class="cell-main">
          <div class="cell-title">My Favorites</div>
          <div class="cell-sub">All saved items</div>
        </div>
        <div class="cell-right">
          Browse <span class="arrow">â€º</span>
        </div>
      </div>

      <!-- My Address -->
      <div class="cell" onclick="goMyAddress()">
        <div class="cell-icon">ğŸ </div>
        <div class="cell-main">
          <div class="cell-title">My Address</div>
          <div class="cell-sub">Manage your shipping address</div>
        </div>
        <div class="cell-right">
          Edit <span class="arrow">â€º</span>
        </div>
      </div>
    </div>

    <!-- Sign out -->
    <div class="signout-card">
      <div class="signout-row" onclick="signOutFromSite()">
        <div class="cell-icon">ğŸšª</div>
        <div class="signout-label">Sign out</div>
      </div>
      <div class="signout-sub">
        You will be signed out from this device only.
      </div>
    </div>
  </div>

  <script>
    /**********************
     *  Google Login éƒ¨åˆ† *
     **********************/
    const GOOGLE_CLIENT_ID =
      "874569690729-8davcc3gf01t5vb470dom6pn28hvihcq.apps.googleusercontent.com";

    // å¤„ç† Google è¿”å›çš„ credentialï¼ˆJWTï¼‰
    async function handleCredentialResponse(response) {
      try {
        // æŠŠ Google çš„ credential å‘ç»™ä½  WordPress åç«¯è‡ªå®šä¹‰æ¥å£åšç™»å½•
        const res = await fetch("https://b1ing.ca/wp-json/b1ing/v1/google-login", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          credentials: "include", // è®© cookie å¸¦ä¸Šï¼ŒWordPress æ‰èƒ½ä¿æŒ Session
          body: JSON.stringify({ credential: response.credential }),
        });

        const data = await res.json();

        if (!res.ok) {
          console.error("Google login failed:", data);
          alert("Login failed: " + (data.message || res.status));
          return;
        }

        // æ ¹æ®åç«¯è¿”å›ä¿¡æ¯æ›´æ–° UIï¼Œè¿™é‡Œå‡è®¾åç«¯è¿”å›ï¼š
        // { display_name, email, orders_count, favorites_count, coupons_count }
        applyUserInfo(data);
      } catch (err) {
        console.error(err);
        alert("Network error, please try again.");
      }
    }

    function initGoogleLogin() {
      if (!window.google || !google.accounts || !google.accounts.id) {
        console.warn("Google Identity Services script not ready yet.");
        return;
      }

      google.accounts.id.initialize({
        client_id: GOOGLE_CLIENT_ID,
        callback: handleCredentialResponse,
        auto_select: false,
        cancel_on_tap_outside: true,
      });

      const btn = document.getElementById("google-btn");
      if (btn) {
        google.accounts.id.renderButton(btn, {
          theme: "outline",
          size: "large",
          width: "100",
        });
      }
    }

    // é¡µé¢åŠ è½½ååˆå§‹åŒ– Google æŒ‰é’®
    window.addEventListener("DOMContentLoaded", () => {
      // ä¿é™©èµ·è§åšä¸ªå°å»¶è¿Ÿï¼Œç¡®ä¿ GIS è„šæœ¬åŠ è½½å®Œ
      setTimeout(initGoogleLogin, 300);
      // ä¹Ÿå¯ä»¥åœ¨è¿™é‡Œå°è¯•ä»åç«¯è·å–å½“å‰ç™»å½•ç”¨æˆ·ä¿¡æ¯ï¼Œæ›´æ–° UIï¼ˆå¯é€‰ï¼‰
    });

    /**********************
     *   UI æ›´æ–°å‡½æ•°      *
     **********************/
    function applyUserInfo(data) {
      const name = data.display_name || data.name || "Member";
      const email = data.email || "Signed in with Google";

      const nameEl = document.getElementById("user-name");
      const subEl = document.getElementById("user-sub");
      const statusEl = document.getElementById("user-status");
      const avatarLetter = document.getElementById("avatar-letter");

      if (nameEl) nameEl.textContent = name;
      if (subEl) subEl.textContent = email;
      if (statusEl) statusEl.textContent = "Signed in";

      if (avatarLetter && name && name.length > 0) {
        avatarLetter.textContent = name.charAt(0).toUpperCase();
      }

      // å¯é€‰ï¼šæ ¹æ®è¿”å›æ•°æ®æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
      if (typeof data.orders_count === "number") {
        const el = document.getElementById("orders-count");
        if (el) el.textContent = data.orders_count;
      }
      if (typeof data.favorites_count === "number") {
        const el = document.getElementById("fav-count");
        if (el) el.textContent = data.favorites_count;
      }
      if (typeof data.coupons_count === "number") {
        const el = document.getElementById("coupon-count");
        if (el) el.textContent = data.coupons_count;
      }
    }

    /**********************
     *  å¯¼èˆªå‡½æ•°ï¼ˆMy Orders/Favorites/Address/Sign outï¼‰
     **********************/
    function goMyOrders() {
      // ç›´æ¥è·³ WooCommerce çš„ â€œMy Ordersâ€ é¡µé¢
      window.location.href = "https://b1ing.ca/my-account/orders/";
    }

    function goMyFavorites() {
      // é¢„ç•™æœ¬åœ°æ”¶è—é¡µé¢ï¼ˆä½ ä¹‹åå¯ä»¥åš favorites.htmlï¼‰
      window.location.href = "favorites.html";
    }

    function goMyAddress() {
      window.location.href = "https://b1ing.ca/my-account/edit-address/";
    }

    function signOutFromSite() {
      // WooCommerce é»˜è®¤æ³¨é”€é“¾æ¥
      window.location.href = "https://b1ing.ca/my-account/customer-logout/";
    }

    /**********************
     *  Facebook ç™»å½•å ä½ï¼ˆæš‚ä¸å±•ç¤ºæŒ‰é’®ï¼‰
     **********************/
    function loginWithFacebook() {
      // è¿™é‡Œä»¥åå¯ä»¥æ¥ Facebook OAuth
      alert("Facebook login is not enabled yet.");
    }
  </script>
</body>
</html>
