<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>My Orders</title>

<style>
  body { margin:0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Arial; background:#f7f7f7; }

  .page-title {
    font-size:20px; font-weight:700; padding:16px; background:white;
    box-shadow:0 1px 4px rgba(0,0,0,0.08); margin-bottom:14px;
  }

  #orders-list { padding:12px; }

  .order-card {
    background:white; border-radius:12px; padding:14px; margin-bottom:12px;
    box-shadow:0 1px 5px rgba(0,0,0,0.1);
  }

  .order-header { display:flex; justify-content:space-between; font-size:14px; margin-bottom:10px; }
  .order-no { font-weight:600; }
  .order-status { color:#ff5500; }

  .order-body { display:flex; gap:12px; }
  .order-thumb { width:70px; height:70px; border-radius:10px; object-fit:cover; background:#eee; }

  .order-info { flex:1; font-size:13px; }
  .order-title { font-weight:600; margin-bottom:4px; }
  .order-items { color:#666; margin-bottom:4px; }
  .order-date { color:#999; }

  .order-total { font-size:16px; font-weight:700; color:#ff5500; align-self:center; }

  .loading { text-align:center; padding:20px; color:#666; }
  .empty { text-align:center; padding:30px; color:#999; }
</style>
</head>

<body>

<div class="page-title">My Orders</div>
<div id="orders-list"></div>

<script>
const ORDERS_API = "https://b1ing.ca/wp-json/b1ing/v1/orders";

/* ========== 加载订单 ========== */
async function loadOrdersFromAPI() {
  const list = document.getElementById("orders-list");
  list.innerHTML = `<div class="loading">Loading your orders...</div>`;

  try {
    const res = await fetch(ORDERS_API, {
      credentials: "include" // 必须带上，以后你恢复权限才能取到登录用户订单
    });

    if (!res.ok) {
      list.innerHTML = `<div class="empty">Failed to load orders.</div>`;
      return;
    }

    const orders = await res.json();
    renderOrders(orders);
  } catch (e) {
    console.error(e);
    list.innerHTML = `<div class="empty">Network error</div>`;
  }
}

/* ========== 渲染订单 ========== */
function renderOrders(orders) {
  const list = document.getElementById("orders-list");

  if (!orders.length) {
    list.innerHTML = `<div class="empty">You have no orders yet.</div>`;
    return;
  }

  list.innerHTML = "";

  orders.forEach(o => {
    const div = document.createElement("div");
    div.className = "order-card";

    div.innerHTML = `
      <div class="order-header">
        <span class="order-no">${o.number}</span>
        <span class="order-status">${o.status}</span>
      </div>

      <div class="order-body">
        <img class="order-thumb" src="${o.thumb || ''}" />

        <div class="order-info">
          <div class="order-title">${o.item_title || 'Item'}</div>
          <div class="order-items">${o.items_count} item(s)</div>
          <div class="order-date">${o.date}</div>
        </div>

        <div class="order-total">CA$ ${Number(o.total).toFixed(2)}</div>
      </div>
    `;

    list.appendChild(div);
  });
}

/* ========== 初始化 ========== */
window.onload = () => loadOrdersFromAPI();
</script>

</body>
</html>
